{% extends "layout.html" %}
{% block content %}
<h2>{{ user.username }}'s Profile</h2>
<p>Followers: {{ user.followers|length }} | Following: {{ user.following|length }}</p>

<!-- Follow User -->
<form method="POST" class="mb-3 d-flex gap-2">
  <input type="text" name="target_user" class="form-control" placeholder="Follow user">
  <button class="btn btn-success" name="action" value="follow">Follow</button>
</form>

<h3>Posts</h3>
{% for post in posts %}
<div class="card mb-3 shadow-sm">
  <div class="card-body">
    <h5>{{ post.author.username }}</h5>
    <p>{{ post.content }}</p>
    <p><small class="text-muted">Likes: {{ post.likes|length }} | Comments: {{ post.comments|length }}</small></p>

    <!-- Like / Comment Form -->
    <form method="POST" class="d-flex gap-2 mb-2">
      <input type="hidden" name="post_index" value="{{ loop.index0 }}">
      <button name="action" value="like" class="btn btn-sm btn-primary">Like</button>
      <input type="text" name="comment_text" class="form-control form-control-sm" placeholder="Comment">
      <button name="action" value="comment" class="btn btn-sm btn-secondary">Comment</button>
    </form>

    <!-- Comments List -->
    <ul class="list-unstyled">
      {% for c in post.comments %}
      <li><strong>{{ c[0].username }}:</strong> {{ c[1] }}</li>
      {% endfor %}
    </ul>
  </div>
</div>
{% endfor %}
{% endblock %}
